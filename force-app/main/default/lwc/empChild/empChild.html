<template>
    <lightning-spinner if:true={loading} alternative-text="Loading" size="medium"></lightning-spinner>
    <lightning-datatable
        key-field="id"
        data={flatLines}
        columns={columns}
        onsave={saveValues}
        oncellchange={handleCellChange}
        oncancel={handleCancel}
        onrowaction={handleRowAction}>
    </lightning-datatable>
    <!--LENGTH UOM POP-UP START-->
    <template if:true={isLengthUomModalOpen}>
        <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true" aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open">
            <div class="slds-modal__container slds-modal__container_uom">
                <header class="slds-modal__header slds-var-m-left_small  slds-var-m-right_small">
                    <h2 class="slds-text-heading_medium slds-hyphenate">Changing LENGTH UOM: {dataRow.Length_UOM__c}</h2>
                    <lightning-icon class="slds-modal__close" icon-name="utility:close" size="small" onclick={closeLengthUomPopup}></lightning-icon>
                </header>
                <div style="overflow: initial;" class="slds-modal__content slds-p-around_medium slds-var-m-left_small  slds-var-m-right_small" >
                    <lightning-combobox class="slds-align_absolute-center" style="width:80%" name="lengthuom" label="Length UOM" value={newLengthUOM}
                    options={lengthUomList} onchange={lengthUomHandler}>
                    </lightning-combobox>
                </div>
                <footer class="slds-modal__footer slds-var-m-left_small  slds-var-m-right_small">
                    <button class="slds-button slds-button_neutral" onclick={closeLengthUomModal} title="Cancel">Cancel</button>
                    <button class="slds-button slds-button_brand" onclick={saveLengthUom} title="Change">Change</button>
                </footer>
            </div>
        </section>
        <div class="slds-backdrop slds-backdrop_open"></div>
    </template>
    <!--LENGTH UOM POP-UP END-->
    <!--UOM POP-UP START-->
    <template if:true={isUomModalOpen}>
        <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true" aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open">
            <div class="slds-modal__container slds-modal__container_uom">
                <header class="slds-modal__header slds-var-m-left_small  slds-var-m-right_small">
                    <h2 class="slds-text-heading_medium slds-hyphenate">Changing UOM: {dataRow.Uom__c}</h2>
                    <lightning-icon class="slds-modal__close" icon-name="utility:close" size="small" onclick={closeUomPopup}></lightning-icon>
                </header>
                <div style="overflow: initial;" class="slds-modal__content slds-p-around_medium slds-var-m-left_small  slds-var-m-right_small">
                    <lightning-combobox class="slds-align_absolute-center" style="width:80%" name="uom" label="UOM" value={newUOM}
                    options={uomList} onchange={uomHandler}>
                    </lightning-combobox>
                </div>
                <footer class="slds-modal__footer slds-var-m-left_small  slds-var-m-right_small">
                    <button class="slds-button slds-button_neutral" onclick={closeUomModal} title="Cancel">Cancel</button>
                    <button class="slds-button slds-button_brand" onclick={saveUom} title="Change">Change</button>
                </footer>
            </div>
        </section>
        <div class="slds-backdrop slds-backdrop_open"></div>
    </template>
    <!--UOM POP-UP END-->
    <!--POP UP NSP PRODUCTS START-->
    <template if:true={isNspModalOpen}>
        <section aria-modal="true" class="slds-modal slds-fade-in-open slds-align_absolute-center">
            <div class="slds-modal__container slds-var-m-left_small  slds-var-m-right_small">
                <header class="slds-modal__header slds-var-m-left_small  slds-var-m-right_small">
                    <h2 class="slds-text-heading_medium slds-hyphenate">NSP Product: {dataRow.SBQQ__ProductName__c}</h2>
                    <!-- <lightning-icon class="slds-modal__close" icon-name="utility:close" size="small" onclick={closeNsp}></lightning-icon> -->
                </header>
                <!--style="overflow: initial;" to show picklist values outside pop-up for combobox component-->
                <div style="overflow: initial;" class="slds-modal__content slds-var-m-left_small  slds-var-m-right_small">
                    <div class="slds-var-p-around_small slds-align_absolute-center">
                        <template if:false={nspShowMessage}>
                            <p style="font-size: 18px;" class="slds-align_absolute-center">This quote line does not have NSP values.</p>
                        </template>
                        <template if:false={showNSP}>
                            <lightning-spinner alternative-text="Loading"></lightning-spinner>
                        </template>
                        <template if:true={nspShowMessage} class="slds-align_absolute-center">
                            <div class="slds-grid slds-wrap slds-var-m-top_medium slds-var-m-left_small slds-var-m-right_small">
                                <h3 class="slds-text-heading_medium slds-hyphenate slds-align_absolute-center slds-var-m-bottom_small">Note: The values are autosaved when changing the field.</h3>
                                <div class="slds-col slds-size_1-of-2">
                                    <template for:each={nspValues} for:item="nspRead">
                                        <lightning-layout key={nspRead.label} vertical-align="center" class="small">
                                            <lightning-layout-item flexibility="auto" padding="around-small">
                                                <p class="slds-var-m-right_medium">{nspRead.label}: {nspRead.value}</p>
                                            </lightning-layout-item>
                                        </lightning-layout>
                                    </template>
                                </div>
                                <div class="slds-col slds-size_1-of-2">
                                    <template if:true={nspOptions}>
                                        <template for:each={nspOptions} for:item="nspChange">
                                            <lightning-combobox key={nspChange.label} name={nspChange.apiName} label={nspChange.label}
                                                options={nspChange.options} onchange={saveNSP}></lightning-combobox>
                                        </template>
                                    </template> 
                                    <template if:true={nspInputs}>
                                        <template for:each={nspInputs} for:item="nspChangeInputs">
                                            <lightning-input key={nspChangeInputs}  type="number" name={nspChangeInputs.label} label={nspChangeInputs.label}
                                                onchange={changingNSP} ></lightning-input>
                                        </template>
                                    </template>
                                </div>
                        </div>
                        </template>
                    </div>
                
                </div>
                <footer class="slds-modal__footer slds-var-m-left_small  slds-var-m-right_small">
                    <lightning-button  variant="destructive-text" label="Close" onclick={closeNsp} class="slds-p-around_x-small slds-m-right_small"></lightning-button>
                    <lightning-helptext content="The values are autosaved when changing the field."></lightning-helptext>

                </footer>
            </div>
        </section>
        <div class="slds-backdrop slds-backdrop_open"></div>
    </template>
    <!--POP UP NSP PRODUCTS END-->
    <!-- <lightning-button
        label="Save & Calculate"
        title="Save & Calculate"
        onclick={saveAndCalculate}    
    ></lightning-button> -->
</template>